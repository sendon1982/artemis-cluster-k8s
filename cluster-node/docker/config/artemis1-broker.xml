<?xml version='1.0'?>
<configuration xmlns="urn:activemq"
               xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
               xsi:schemaLocation="urn:activemq /schema/artemis-configuration.xsd">

  <core>
    <!-- Broker Identity -->
    <name>artemis-cluster</name>

    <!-- Persistence -->
    <persistence-enabled>true</persistence-enabled>
    <journal-directory>data/journal</journal-directory>
    <bindings-directory>data/bindings</bindings-directory>
    <paging-directory>data/paging</paging-directory>
    <large-messages-directory>data/large-messages</large-messages-directory>

    <!-- Acceptors -->
    <acceptors>
      <!-- Core/MQTT/AMQP/OPENWIRE etc. can be enabled -->
      <acceptor name="core">tcp://0.0.0.0:61616</acceptor>
      <acceptor name="web">http://0.0.0.0:8161</acceptor>
    </acceptors>

    <!-- Cluster Connection -->
    <cluster-connections>
      <cluster-connection name="my-cluster">
        <connector-ref>artemis-connector</connector-ref>
        <retry-interval>1000</retry-interval>
        <retry-interval-multiplier>2.0</retry-interval-multiplier>
        <max-retry-interval>32000</max-retry-interval>
        <initial-connect-attempts>-1</initial-connect-attempts>
        <reconnect-attempts>-1</reconnect-attempts>
        <use-duplicate-detection>true</use-duplicate-detection>
        <message-load-balancing>ON_DEMAND</message-load-balancing>
        <max-hops>1</max-hops>
        <static-connectors>
          <!-- These hostnames come from Kubernetes StatefulSet DNS -->
          <connector-ref>artemis-0</connector-ref>
          <connector-ref>artemis-1</connector-ref>
          <connector-ref>artemis-2</connector-ref>
        </static-connectors>
      </cluster-connection>
    </cluster-connections>

    <!-- Connectors (point to each podâ€™s hostname) -->
    <connectors>
      <connector name="artemis-connector">tcp://0.0.0.0:61616</connector>
      <connector name="artemis-0">tcp://artemis-0.artemis-headless:61616</connector>
      <connector name="artemis-1">tcp://artemis-1.artemis-headless:61616</connector>
      <connector name="artemis-2">tcp://artemis-2.artemis-headless:61616</connector>
    </connectors>

    <!-- High Availability Policy -->
    <ha-policy>
      <!-- Replicated journal HA -->
      <replication>
        <master/>
      </replication>
    </ha-policy>

    <!-- Security (optional, enable login) -->
    <security-settings>
      <security-setting match="#">
        <permission type="createDurableQueue" roles="amq"/>
        <permission type="deleteDurableQueue" roles="amq"/>
        <permission type="createNonDurableQueue" roles="amq"/>
        <permission type="deleteNonDurableQueue" roles="amq"/>
        <permission type="consume" roles="amq"/>
        <permission type="browse" roles="amq"/>
        <permission type="send" roles="amq"/>
        <permission type="manage" roles="amq"/>
      </security-setting>
    </security-settings>

    <!-- Address settings -->
    <address-settings>
      <address-setting match="#">
        <dead-letter-address>DLQ</dead-letter-address>
        <expiry-address>ExpiryQueue</expiry-address>
        <redelivery-delay>0</redelivery-delay>
        <max-delivery-attempts>10</max-delivery-attempts>
        <max-size-bytes>10485760</max-size-bytes>
        <page-size-bytes>2097152</page-size-bytes>
        <message-counter-history-day-limit>10</message-counter-history-day-limit>
        <address-full-policy>PAGE</address-full-policy>
      </address-setting>
    </address-settings>

    <!-- System queues -->
    <addresses>
      <address name="DLQ">
        <anycast>
          <queue name="DLQ"/>
        </anycast>
      </address>
      <address name="ExpiryQueue">
        <anycast>
          <queue name="ExpiryQueue"/>
        </anycast>
      </address>
    </addresses>
  </core>
</configuration>
